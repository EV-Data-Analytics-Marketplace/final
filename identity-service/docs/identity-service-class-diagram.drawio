<mxfile host="app.diagrams.net" modified="2025-11-20T00:00:00Z" agent="github-copilot" version="20.5.3">
  <diagram name="Identity Service Classes" id="diagram-1">
    <mxGraphModel dx="1600" dy="1200" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1400" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <mxCell id="nUser" value="User&#xa;---&#xa;- id: Long&#xa;- email: String&#xa;- password: String&#xa;- fullName: String&#xa;- role: String&#xa;- status: String&#xa;- emailVerified: Boolean&#xa;- createdAt: LocalDateTime&#xa;---&#xa;+ onCreate(): void&#xa;+ onUpdate(): void" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="40" y="240" width="240" height="240" as="geometry"/>
        </mxCell>
        <mxCell id="nRefreshToken" value="RefreshToken&#xa;---&#xa;- id: Long&#xa;- token: String&#xa;- user: User&#xa;- expiryDate: LocalDateTime&#xa;- revoked: Boolean&#xa;- createdAt: LocalDateTime&#xa;---&#xa;+ onCreate(): void&#xa;+ isExpired(): boolean" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="40" y="520" width="240" height="220" as="geometry"/>
        </mxCell>
        <mxCell id="nUserRepo" value="UserRepository&#xa;extends JpaRepository&lt;User, Long&gt;&#xa;---&#xa;+ findByEmail(String): Optional&lt;User&gt;&#xa;+ existsByEmail(String): Boolean&#xa;+ findByRole(String): List&lt;User&gt;&#xa;+ findByStatus(String): List&lt;User&gt;&#xa;+ findByRoleAndStatus(String,String): List&lt;User&gt;" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="340" y="220" width="260" height="220" as="geometry"/>
        </mxCell>
        <mxCell id="nRefreshRepo" value="RefreshTokenRepository&#xa;extends JpaRepository&lt;RefreshToken, Long&gt;&#xa;---&#xa;+ findByToken(String): Optional&lt;RefreshToken&gt;&#xa;+ findByUserId(Long): List&lt;RefreshToken&gt;&#xa;+ deleteByUserId(Long): void&#xa;+ deleteExpiredAndRevoked(LocalDateTime): void" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="340" y="470" width="260" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="nJpaRepository" value="JpaRepository&lt;T, ID&gt;&#xa;---&#xa;+ save(T): T&#xa;+ findById(ID): Optional&lt;T&gt;&#xa;+ findAll(): List&lt;T&gt;&#xa;+ delete(T): void" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;fontStyle=2;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="340" y="720" width="220" height="170" as="geometry"/>
        </mxCell>
        <mxCell id="nAuthService" value="AuthService&#xa;---&#xa;- userRepository: UserRepository&#xa;- refreshTokenRepository: RefreshTokenRepository&#xa;- passwordEncoder: PasswordEncoder&#xa;- jwtUtil: JwtUtil&#xa;- authenticationManager: AuthenticationManager&#xa;- refreshTokenExpiration: Long&#xa;---&#xa;+ login(LoginRequest): AuthResponse&#xa;+ register(RegisterRequest): AuthResponse&#xa;+ refreshToken(RefreshTokenRequest): AuthResponse&#xa;+ logout(String): void&#xa;+ saveRefreshToken(User,String): void&#xa;+ mapToUserResponse(User): UserResponse" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="640" y="320" width="280" height="320" as="geometry"/>
        </mxCell>
        <mxCell id="nUserService" value="UserService&#xa;---&#xa;- userRepository: UserRepository&#xa;- passwordEncoder: PasswordEncoder&#xa;---&#xa;+ getUserProfile(String): UserResponse&#xa;+ getUserById(Long): UserResponse&#xa;+ getAllUsers(): List&lt;UserResponse&gt;&#xa;+ getUsersByRole(String): List&lt;UserResponse&gt;&#xa;+ getUsersByStatus(String): List&lt;UserResponse&gt;&#xa;+ updateProfile(String, RegisterRequest): UserResponse&#xa;+ changePassword(String, ChangePasswordRequest): void&#xa;+ updateUserStatus(Long,String): UserResponse&#xa;+ updateUserRole(Long,String): UserResponse&#xa;+ deleteUser(Long): void&#xa;+ mapToUserResponse(User): UserResponse" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="640" y="660" width="280" height="360" as="geometry"/>
        </mxCell>
        <mxCell id="nJwtUtil" value="JwtUtil&#xa;---&#xa;- jwtSecret: String&#xa;- jwtExpiration: Long&#xa;- refreshExpiration: Long&#xa;- signer: JWSSigner&#xa;- verifier: JWSVerifier&#xa;---&#xa;+ init(String): void&#xa;+ generateAccessToken(User): String&#xa;+ generateRefreshToken(User): String&#xa;+ extractEmail(String): String&#xa;+ validateToken(String): Boolean&#xa;+ getExpirationTime(): Long" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="980" y="320" width="260" height="280" as="geometry"/>
        </mxCell>
        <mxCell id="nCustomUserDetailsService" value="CustomUserDetailsService&#xa;implements UserDetailsService&#xa;---&#xa;- userRepository: UserRepository&#xa;---&#xa;+ loadUserByUsername(String): UserDetails&#xa;+ loadUserById(Long): UserDetails" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="980" y="640" width="260" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="nUserDetailsService" value="UserDetailsService (interface)&#xa;---&#xa;+ loadUserByUsername(String): UserDetails" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;fontStyle=2;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="980" y="880" width="260" height="140" as="geometry"/>
        </mxCell>
        <mxCell id="nAuthController" value="AuthController&#xa;---&#xa;- authService: AuthService&#xa;---&#xa;+ login(LoginRequest): ResponseEntity&#xa;+ register(RegisterRequest): ResponseEntity&#xa;+ refreshToken(RefreshTokenRequest): ResponseEntity&#xa;+ logout(String): ResponseEntity" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="640" y="40" width="260" height="220" as="geometry"/>
        </mxCell>
        <mxCell id="nUserController" value="UserController&#xa;---&#xa;- userService: UserService&#xa;---&#xa;+ getUserProfile(Authentication): ResponseEntity&#xa;+ getUserById(Long): ResponseEntity&#xa;+ getAllUsers(): ResponseEntity&#xa;+ updateProfile(Authentication, RegisterRequest): ResponseEntity&#xa;+ changePassword(Authentication, ChangePasswordRequest): ResponseEntity&#xa;+ updateUserStatus(Long,String): ResponseEntity&#xa;+ updateUserRole(Long,String): ResponseEntity&#xa;+ deleteUser(Long): ResponseEntity" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="960" y="40" width="300" height="260" as="geometry"/>
        </mxCell>
        <mxCell id="nAdminController" value="AdminController&#xa;---&#xa;- userService: UserService&#xa;- refreshTokenRepository: RefreshTokenRepository&#xa;---&#xa;+ getAllUsers(): ResponseEntity&#xa;+ getUserStats(): ResponseEntity&#xa;+ getUsersByRole(String): ResponseEntity&#xa;+ getUsersByStatus(String): ResponseEntity&#xa;+ updateUserStatus(Long,String): ResponseEntity&#xa;+ updateUserRole(Long,String): ResponseEntity&#xa;+ deleteUser(Long): ResponseEntity&#xa;+ suspendUser(Long,String): ResponseEntity&#xa;+ activateUser(Long): ResponseEntity&#xa;+ getTokenStats(): ResponseEntity" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="1280" y="40" width="320" height="320" as="geometry"/>
        </mxCell>
        <mxCell id="nSecurityConfig" value="SecurityConfig&#xa;---&#xa;- jwtSecret: String&#xa;---&#xa;+ securityFilterChain(HttpSecurity): SecurityFilterChain&#xa;+ jwtAuthenticationConverter(): JwtAuthenticationConverter&#xa;+ corsConfigurationSource(): CorsConfigurationSource&#xa;+ authenticationManager(AuthenticationConfiguration): AuthenticationManager&#xa;+ passwordEncoder(): PasswordEncoder&#xa;+ jwtDecoder(): JwtDecoder" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="1280" y="380" width="320" height="260" as="geometry"/>
        </mxCell>
        <mxCell id="nGlobalExceptionHandler" value="GlobalExceptionHandler&#xa;---&#xa;+ handleValidationException(MethodArgumentNotValidException): ResponseEntity&#xa;+ handleUsernameNotFoundException(UsernameNotFoundException): ResponseEntity&#xa;+ handleBadCredentialsException(BadCredentialsException): ResponseEntity&#xa;+ handleRuntimeException(RuntimeException): ResponseEntity&#xa;+ handleGlobalException(Exception): ResponseEntity" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="1280" y="680" width="320" height="260" as="geometry"/>
        </mxCell>
        <mxCell id="nLoginRequest" value="LoginRequest&#xa;---&#xa;- email: String&#xa;- password: String" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="360" y="1040" width="200" height="120" as="geometry"/>
        </mxCell>
        <mxCell id="nRegisterRequest" value="RegisterRequest&#xa;---&#xa;- email: String&#xa;- password: String&#xa;- fullName: String&#xa;- phoneNumber: String&#xa;- organization: String&#xa;- role: String&#xa;- address: String&#xa;- country: String&#xa;- city: String" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="880" y="1320" width="260" height="220" as="geometry"/>
        </mxCell>
        <mxCell id="nChangePasswordRequest" value="ChangePasswordRequest&#xa;---&#xa;- currentPassword: String&#xa;- newPassword: String" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="1180" y="1060" width="220" height="130" as="geometry"/>
        </mxCell>
        <mxCell id="nRefreshTokenRequest" value="RefreshTokenRequest&#xa;---&#xa;- refreshToken: String" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="1440" y="1060" width="210" height="110" as="geometry"/>
        </mxCell>
        <mxCell id="nAuthResponse" value="AuthResponse&#xa;---&#xa;- accessToken: String&#xa;- refreshToken: String&#xa;- tokenType: String&#xa;- expiresIn: Long&#xa;- user: UserResponse" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="640" y="1060" width="240" height="170" as="geometry"/>
        </mxCell>
        <mxCell id="nUserResponse" value="UserResponse&#xa;---&#xa;- id: Long&#xa;- email: String&#xa;- fullName: String&#xa;- role: String&#xa;- status: String&#xa;- emailVerified: Boolean&#xa;- address: String&#xa;- country: String&#xa;- city: String&#xa;- avatar: String&#xa;- createdAt: LocalDateTime&#xa;- lastLoginAt: LocalDateTime" style="shape=rectangle;whiteSpace=wrap;html=1;fontSize=12;rounded=0;strokeWidth=1.5;" vertex="1" parent="1">
          <mxGeometry x="920" y="1060" width="260" height="220" as="geometry"/>
        </mxCell>
        <mxCell id="edge1" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAuthController" target="nAuthService">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge2" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nUserController" target="nUserService">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge3" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAdminController" target="nUserService">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge4" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAdminController" target="nRefreshRepo">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge5" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAuthService" target="nUserRepo">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge6" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAuthService" target="nRefreshRepo">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge7" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAuthService" target="nJwtUtil">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge8" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nUserService" target="nUserRepo">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge9" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nCustomUserDetailsService" target="nUserRepo">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge10" style="endArrow=block;endFill=0;strokeWidth=2;" edge="1" parent="1" source="nCustomUserDetailsService" target="nUserDetailsService">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge11" style="endArrow=block;endFill=0;strokeWidth=2;" edge="1" parent="1" source="nUserRepo" target="nJpaRepository">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge12" style="endArrow=block;endFill=0;strokeWidth=2;" edge="1" parent="1" source="nRefreshRepo" target="nJpaRepository">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge13" style="startArrow=diamond;startFill=1;endArrow=none;strokeWidth=2;" edge="1" parent="1" source="nUser" target="nRefreshToken">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge14" style="startArrow=diamond;startFill=0;endArrow=none;strokeWidth=2;" edge="1" parent="1" source="nAuthResponse" target="nUserResponse">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge15" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAuthController" target="nLoginRequest">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge16" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAuthController" target="nRegisterRequest">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge17" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAuthController" target="nRefreshTokenRequest">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge18" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nUserController" target="nRegisterRequest">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge19" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nUserController" target="nChangePasswordRequest">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge20" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nAuthService" target="nAuthResponse">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge21" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nJwtUtil" target="nUser">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="edge22" style="endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="1" source="nSecurityConfig" target="nJwtUtil">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
